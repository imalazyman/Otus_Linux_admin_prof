#!/bin/bash
# MySQL restore script - runs on database servers

BACKUP_FILE="$1"

if [ -z "$BACKUP_FILE" ]; then
    echo "Usage: $0 /path/to/backup.sql.gz"
    exit 1
fi

if [ ! -f "$BACKUP_FILE" ]; then
    echo "Backup file not found: $BACKUP_FILE"
    exit 1
fi

echo "Restoring MySQL database from $BACKUP_FILE"

# Restore the database
zcat "$BACKUP_FILE" | mysql -u root -p"{{ mariadb_root_password }}" project_db

if [ $? -eq 0 ]; then
    echo "✓ MySQL database restored successfully"
else
    echo "✗ MySQL database restore failed"
    exit 1
fi